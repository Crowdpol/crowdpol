<template name="Voting">
	{{#if currentUser}}
	<!-- MDL Tab Container -->
	<div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
		<!-- Tab Bars -->
		<div class="tabs-wrap mdl-tabs__tab-bar">
			<a href="#vote-proposals-panel" id="vote-proposals-tab" class="mdl-tabs__tab {{votesTabActive}}">{{_ "pages.voting.tabs.voteProposals"}}</a>
			<a href="#closed-proposals-panel" id="closed-proposals-tab" class="mdl-tabs__tab {{completedTabActive}}">{{_ "pages.voting.tabs.completedProposals"}}</a>
		</div>

		<div class="app-container search-container">
			<!-- Search bar -->
			<div class="search-wrapper">
				<i class="material-icons search-icon">search</i>
				<input type="text" name="focus" required class="search-box" placeholder='{{_ "pages.proposals.list.search"}}' id="vote-search"/>
				<button class="close-icon" type="reset">
					<i class="material-icons">close</i>
				</button>
			</div>

			<!-- MDL tab panels, is-active to denote currently active -->
			<div class="mdl-tabs__panel {{votesTabActive}}" id="vote-proposals-panel">

				{{#if Template.subscriptionsReady}}
					<!-- CHECK IF USER HAS MULTIPLE ROLES -->
					{{#if userHasMultipleRoles}}
						<!-- Role Selection Menu -->
						<h4>
							<a id="demo-menu-lower-left" class="mdl-navigation__link" href="/voting">
								{{ voteDropdownText }}<i class="material-icons">arrow_drop_down</i>
							</a>
						</h4>
						<ul class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="demo-menu-lower-left">
							<li class="mdl-menu__item role-menu-item" data-role="Individual">
									{{_ "pages.voting.heading.individual"}}
									{{#if isVotingAsIndividual}}
										<i class="material-icons small">check</i>
									{{/if}}
							</li>
							<li class="mdl-menu__item role-menu-item" data-role="Delegate">
									{{_ "pages.voting.heading.delegate"}}
									{{#if isVotingAsDelegate}}
										<i class="material-icons small">check</i>
									{{/if}}
							</li>
						</ul>
						<!-- DISPLAY DESCRIPTION ACCORDING TO ROLE-->
						{{#if isVotingAsDelegate}}
							<p>{{_ "pages.voting.delegate-description"}}</p>
						{{else}}
							<p>{{_ "pages.voting.individual-description"}}</p>
						{{/if}}
					{{else}}
						<h4>{{_ "pages.voting.heading.individual"}}</h4>
						<p>{{_ "pages.voting.individual-description"}}</p>
					{{/if}}
					<ul class="demo-list-control mdl-list">
						{{#each openProposals isVotingAsDelegate}}
							{{> VotingCard}}
						{{else}}
							{{_ "pages.voting.no-open-proposals"}}
							<a href="/proposals/edit">{{_"pages.dashboard.card.proposals.new-proposal"}}</a>
						{{/each}}
					</ul>

				{{else}}
					{{> loader}}
				{{/if}}
			</div>
			<div class="mdl-tabs__panel {{completedTabActive}}" id="closed-proposals-panel">
				<h4>{{_ "pages.voting.heading.completed"}}</h4>
				<p>{{_ "pages.voting.completed-description"}}</p>
				<ul class="demo-list-control mdl-list">
						{{#each closedProposals}}
						{{> ResultCard}}
						{{/each}}
					</ul>
			</div>
		</div>
	</div>
	{{/if}}
</template>

<template name="VotingCard">
	<div class="vote-item">
		<div class="card-main-wrap">
			<div class="tag-wrap">
				<span class="tag status-chip">Complete</span>
			</div>
			<div class="card-date">
				<i class="material-icons">date_range</i>
				<span>{{_ "pages.voting.expires"}} {{expireDate this}}</span>
			</div>
			<div class="card-title">
				<h6>
					<a href="/proposals/view/{{_id}}" class="card-link">
					{{ title this }}
					</a>
				</h6>
				<div class="card-actions-wrap">
					<span>23</span>
					<button class="mdl-button mdl-js-button mdl-button--icon">
						<i class="material-icons">favorite</i>
					</button>
				</div>
				<div class="card-actions-wrap">
					<span>23</span>
					<button class="mdl-button mdl-js-button mdl-button--icon">
						<i class="material-icons">share</i>
					</button>
				</div>
			</div>
		</div>
		<div class="card-secondary-wrap">
			<p class="proposal-abstract">{{ abstract this }}</p>
			{{#each tags this}}
				<a href="/tag/{{keyword}}" class="tag tag-chip">{{keyword}}</a>
			{{/each}}
		</div>

		<div class="card-voting-wrap">
			<!-- Vote buttons and Delegates List -->
			{{#if isVotingAsDelegate}}
				<div class="voting-card-buttons">
					{{_ "pages.voting.voting-card-heading.delegate"}}
					{{> delegateVoteButtons proposalId=_id endDate=endDate}}
				</div>
			{{else}}
				<div class="voting-card-buttons">
					{{_ "pages.voting.voting-card-heading.individual"}}
					{{> voteButtons proposalId=_id}}
				</div>
			{{/if}}

			{{#if showVotingInfo}}
				<div id="voting-info">
					{{#if isVotingAsDelegate}}
					{{else}}
						<!-- How user's delegates voted -->
						{{> delegateVoteList proposalId=_id}}
					{{/if}}
					<!-- Vote Tallies -->
				</div>
			{{/if}}

			{{#if hasVotes _id}}
				<span class="proposal-percentage-text-left">{{_ "pages.voting.for"}} {{ yesPercentage _id }} </span>
				<span class="proposal-percentage-text-right">{{_ "pages.voting.against"}} {{ noPercentage _id }} </span>
				<div class="proposal-vote-progress-bar">
					<div class="proposal-vote-yes-bar" style="width:{{ yesPercentage _id }}%"></div>
				</div>
			{{else}}
				<small class="proposal-percentage-text-left">{{_ "pages.voting.no-votes-used"}}</small>
			{{/if}}
				<!-- Show More/Less Button -->
				<center>
					<a id="toggle-voting-info" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
						{{#if showVotingInfo}}
							{{_ "pages.voting.show-less"}} <i class="material-icons">expand_less</i>
						{{else}}
							{{_ "pages.voting.show-more"}} <i class="material-icons">expand_more</i>
						{{/if}}
					</a>
				</center>

		</div>

	</div>

</template>

<template name="ResultCard">
	<div class="voting-card mdl-card mdl-shadow--2dp">
		<div class="mdl-card__title mdl-card--expand">
			<div class="card-main-wrap">
				<span class="card-main mdl-list__item-primary-content">
						<h6>
							<a href="/proposals/view/{{_id}}" class="proposal-list-item-link"><h6>{{ title this}}</h6></a>
						</h6>
					</span>

					<span class="mdl-list__item-secondary-action">
							<small class="card-date">
								<i class="material-icons">date_range</i>&nbsp;{{ started this.startDate }}&nbsp;-&nbsp;{{ completed this.endDate }}&nbsp;
							</small>
					</span>
			</div>
		</div>
		<div class="mdl-card__supporting-text">
			<span class="tag status-chip">
						 complete
					</span>
					{{#each tags this}}
						<a href="/tag/{{keyword}}" class="tag tag-chip">{{keyword}}</a>
					{{/each}}
			<p class="proposal-abstract">{{ abstract this }}</p>
			<!-- Vote Tallies -->
			{{#if hasVotes _id}}
						<span class="proposal-percentage-text-left">{{_ "pages.voting.for"}} {{ yesPercentage _id }}% </span>
						<span class="proposal-percentage-text-right">{{_ "pages.voting.against"}} {{ noPercentage _id }}% </span>
						<div class="proposal-vote-progress-bar">
							<div class="proposal-vote-yes-bar" style="width:{{ yesPercentage _id }}%"></div>
						</div>
			{{/if}}
		</div>

		<div class="mdl-card__actions mdl-card--border">
			{{#if hasVotes _id}}
				<!-- Show More/Less Button -->
				<a id="toggle-voting-info" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
					{{#if showVotingInfo}}
						{{_ "pages.voting.show-less"}} <i class="material-icons">expand_less</i>
					{{else}}
						{{_ "pages.voting.show-more"}} <i class="material-icons">expand_more</i>
					{{/if}}
				</a>
				{{#if showVotingInfo}}
					<div id="voting-info" class="expandable">
						<!-- How user's delegates voted -->
						{{> delegateVoteList proposalId=_id}}
						<!-- Vote Tallies -->
						<center><small>Graphs coming soon...</small></center>
					</div>
				{{/if}}
			{{else}}
				<center><small>{{_ "pages.voting.no-votes-used"}}</small></center>
			{{/if}}
		</div>
	</div>

</template>

