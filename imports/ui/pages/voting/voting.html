<template name="Voting">
	{{#if currentUser}}
	<!-- MDL Tab Container -->

	<div class="app-container search-container">
		<div class="search-wrapper">
				<form>
				<label>
					<i class="material-icons search-icon">search</i>
				</label>

				<input type="text" name="focus" required class="search-box" placeholder='{{_ "pages.proposals.list.search"}}' id="vote-search"/>
				<button class="close-icon" type="reset"></button>
				</form>
		</div>

		<!-- MDL tab panels, is-active to denote currently active -->
		<div class="mdl-tabs__panel is-active" id="vote-proposals-panel">

			{{#if Template.subscriptionsReady}}
			{{#if userHasMultipleRoles}}
				<!-- Role Selection Menu -->
				<h4>
					<a id="demo-menu-lower-left" class="mdl-navigation__link" href="/voting">
						{{ voteDropdownText }}<i class="material-icons">arrow_drop_down</i>
					</a>
				</h4>
				<ul class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="demo-menu-lower-left">
					<li class="mdl-menu__item role-menu-item" data-role="Individual">
							{{_ "pages.voting.heading.individual"}}
							{{#if isVotingAsIndividual}}
								<i class="material-icons small">check</i>
							{{/if}}
					</li>
					<li class="mdl-menu__item role-menu-item" data-role="Delegate">
							{{_ "pages.voting.heading.delegate"}}
							{{#if isVotingAsDelegate}}
								<i class="material-icons small">check</i>
							{{/if}}
					</li>
				</ul>
				{{#if isVotingAsDelegate}}
					<span>{{_ "pages.voting.delegate-description"}}</span>
				{{else}}
					<span>{{_ "pages.voting.individual-description"}}</span>
				{{/if}}
			{{else}}
				<h4>{{_ "pages.voting.heading.individual"}}</h4>
				<span>{{_ "pages.voting.individual-description"}}</span>
			{{/if}}

			<ul class="demo-list-control mdl-list">
				{{#each openProposals}}
				{{> VotingCard}}
				{{/each}}
			</ul>

			{{else}}
			{{> loader}}
			{{/if}}
		</div>
	</div>
	{{/if}}
</template>

<template name="VotingCard">

	<div class="voting-card mdl-card mdl-shadow--2dp">
		<div class="mdl-card__title mdl-card--expand">
			<a href="/proposals/view/{{_id}}" class="proposal-list-item-link"><h6>{{ title this}}</h6></a>
		</div>
		<div class="mdl-card__supporting-text">
			<p class="proposal-abstract">{{ abstract this }}</p>
		</div>

		<div class="mdl-card__actions mdl-card--border">
			<!-- Show More/Less Button -->
			<a id="toggle-voting-info" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
				{{#if showVotingInfo}}
					{{_ "pages.voting.show-less"}} <i class="material-icons">expand_less</i>
				{{else}}
					{{_ "pages.voting.show-more"}} <i class="material-icons">expand_more</i>
				{{/if}}
			</a>

			{{#if showVotingInfo}}
				<div id="voting-info" class="expandable">

				<!-- Vote Tallies -->
					<div class="mdl-card__actions">
					{{#if hasVotes _id}}
						<span class="proposal-percentage-text-left">{{_ "pages.voting.for"}} {{ yesPercentage _id }}% </span>
						<span class="proposal-percentage-text-right">{{_ "pages.voting.against"}} {{ noPercentage _id }}% </span>
						<div class="proposal-vote-progress-bar">
							<div class="proposal-vote-yes-bar" style="width:{{ yesPercentage _id }}%"></div>
						</div>
					{{else}}
						<small class="proposal-percentage-text-left">{{_ "pages.voting.no-votes-used"}}</small>
					{{/if}}

					</div>
					<hr>

				<!-- Vote buttons and Delegates List -->
				{{#if isVotingAsDelegate}}
					<div class="voting-card-buttons">
					<h6>{{_ "pages.voting.voting-card-heading.delegate"}}</h6>
					{{> delegateVoteButtons proposalId=_id endDate=endDate}}
					</div>
				{{else}}
					<div class="voting-card-buttons">
					<h6>{{_ "pages.voting.voting-card-heading.individual"}}</h6>
					{{> voteButtons proposalId=_id}}
					</div>
					<!-- How user's delegates voted -->
					{{> delegateVoteList proposalId=_id}}
				{{/if}}
				
			</div>

			{{/if}}
		</div>

	</div>

</template>
