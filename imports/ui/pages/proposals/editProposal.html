<template name='EditProposal' >
	{{#if currentUser}}
		{{#if Template.subscriptionsReady}}

			{{> backButton text="generic.back-to-proposals" url="/dash"}}
			<!-- Include Quill stylesheet -->
			<link href="https://cdn.quilljs.com/1.0.0/quill.snow.css" rel="stylesheet">

			<div class="app-container">
				<h3>{{_ "pages.proposals.edit.heading"}}</h3>

				<!-- Tabs for translations -->
				<div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
					<div class="mdl-tabs__tab-bar">
						{{#each languages}}
						<a href="#{{this}}-panel" class="mdl-tabs__tab {{activeClass this}}">{{this}}</a>
						{{/each}}
					</div>

					{{#each languages}}
					<div class="mdl-tabs__panel {{activeClass this}}" id="{{this}}-panel">

						{{> ProposalForm lang=this}}

					</div>
					{{/each}}
				</div>

			</div>

			<!-- Toast to show autosave progress -->
			<div id="autosave-toast-container" class="mdl-js-snackbar mdl-snackbar">
				<div class="mdl-snackbar__text"></div>
				<button class="mdl-snackbar__action" type="button"></button>
			</div>

		{{/if}}
	{{/if}}
	
</template>

<template name='ProposalForm'>
	
	<form id="edit-proposal-form-{{lang}}">
		<div class="input-wrap mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
			<label class="mdl-textfield__label">{{_ "pages.proposals.edit.title"}}</label>
			<input type="text" name="title" id="title-{{lang}}" class="mdl-textfield__input">
		</div>

		<div class="input-wrap mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
			<textarea class="mdl-textfield__input" type="text" rows= "5" name="abstract" id="abstract-{{lang}}"></textarea>
			<label class="mdl-textfield__label">{{_ "pages.proposals.edit.abstract"}}</label>
		</div>

		<small>{{_ "pages.proposals.edit.body"}}</small>

		<!-- Toolbar for the quill editor -->
		<div id="toolbar-{{lang}}">
			<button class="ql-bold">Bold</button>
			<button class="ql-italic">Italic</button>
			<button class="ql-link">Link</button>
			<button class="ql-blockquote">Blockquote</button>
			<button class="ql-image">Image</button>
		</div>

		<!-- Quill editor container -->
		<div id="body-editor-{{lang}}">
		</div>
		<input type="hidden" name="body" id="body-{{lang}}" class="mdl-textfield__input">

		<br/>

		<!-- Points for and against -->

		<div class="mdl-grid">
			<small>{{_ "pages.proposals.edit.forAndAgainst"}}</small>
			<div class="mdl-cell mdl-cell--6-col mdl-cell--6-col-tablet mdl-cell--12-col-phone">
				<div class="input-wrap mdl-textfield mdl-js-textfield mdl-textfield--floating-label proposal-points">
					<label class="mdl-textfield__label" >{{_ "pages.proposals.edit.pointFor"}}</label>
					<textarea class="mdl-textfield__input" type="text" rows= "1" id="inputPointFor-{{lang}}" name="inputPointFor"></textarea>
				</div>
				<button class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored pointsButton" id="add-point-for-{{lang}}" style="position: relative; bottom: 60px; float: right;">
					<i class="material-icons">add</i>
				</button>
				<ul id="points-for-list-{{lang}}" class="pointsList">
					{{#each pointsFor}}
					<li id="point-for-{{@index}}" class="pointsListItem">
						{{this}}
						<button class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored pointsButton" id="remove-point-for-{{lang}}" data-id="{{@index}}" style="position: relative; float: right; display: none;">
							<i class="material-icons">remove</i>
						</button>
					</li>
					{{/each}}
				</ul>
			</div>
			<div class="mdl-cell mdl-cell--6-col mdl-cell--6-col-tablet mdl-cell--12-col-phone">
				<div class="input-wrap mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="pointsAgainstWrap">
					<textarea class="mdl-textfield__input" type="text" rows= "1" id="inputPointAgainst-{{lang}}" name="inputPointAgainst"></textarea>
					<label class="mdl-textfield__label" for="inputPointAgainst">{{_ "pages.proposals.edit.pointAgainst"}}</label>
				</div>
				<button class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored pointsButton" id="add-point-against-{{lang}}" style="position: relative; bottom: 60px; float: right;">
					<i class="material-icons">add</i>
				</button>
				<ul id="points-against-list" class="pointsList">
					{{#each pointsAgainst}}
					<li  id="point-against-{{@index}}" class="pointsListItem">
						{{this}}
						<button class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored pointsButton" id="remove-point-against-{{lang}}" style="position: relative; float: right; display: none;">
							<i class="material-icons">remove</i>
						</button>
					</li>
					{{/each}}
				</ul>
			</div>

		</div>
		<!-- Start and end dates -->

		<div class="small-inputs-wrap">
			<div class="input-wrap mdl-textfield mdl-js-textfield mdl-textfield--floating-label is-dirty">
				<label class="mdl-textfield__label">{{_ "pages.proposals.edit.startDate"}}</label>
				<input type="date" name="startDate" id="startDate" class="mdl-textfield__input">
			</div>
			
			<div class="input-wrap mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
				<label class="mdl-textfield__label">{{_ "pages.proposals.edit.endDate"}}</label>
				<input type="date" name="endDate" id="endDate" class="mdl-textfield__input">
			</div>
		</div>
		<!--<small>{{_ "pages.proposals.edit.tags"}}</small>-->
		{{> taggle }}

		<!-- User invitation field -->
		<div class="form-group">
			{{> UserSearch}}
		</div>
		<div class="form-group">
			<div id="invited-users">
				{{#each selectedInvites}}
				<span class="mdl-chip mdl-chip--contact mdl-chip--deletable">
					<img class="mdl-chip__contact" src="{{profile.photo}}">
					<span class="mdl-chip__text">{{profile.firstName}}&nbsp;{{profile.lastName}}</span>
					<a href="#" class="mdl-chip__action remove-invite" data-user-id="{{_id}}"><i class="material-icons">cancel</i></a>
				</span>
				{{/each}}
			</div>
			<div id="invited-users-email">
				{{#each value in emailedInvites}}
				<span class="mdl-chip mdl-chip--contact">
					<span class="mdl-chip__contact mdl-color--teal mdl-color-text--white"><i class="material-icons email-invites">mail</i></span>
					<span class="mdl-chip__text">{{value}}</span>
					<a href="#" class="mdl-chip__action remove-invite-email" data-array-index="{{@index}}"><i class="material-icons">cancel</i></a>
				</span>
				{{/each}}
			</div>
		</div>
		<br>
		<div class="form-group">
			<input type="submit" id="save-proposal" class="primary-button mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised" value='{{_ "form.save"}}'>
			<input id="preview-proposal" class="secondary-button mdl-button mdl-js-button mdl-js-ripple-effect" value='{{_ "generic.preview"}}'>
		</div>
	</form>
	
</template>


