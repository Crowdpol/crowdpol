<template name="ViewProposal">
	{{> SignInModal}}
	{{#if currentUser }}
		{{> backButton text="generic.back-to-proposals" url=backUrl}}
	{{/if}}
	{{#if Template.subscriptionsReady}}

	<div class="app-container proposal-container">
		{{#if isVisible }}

		<!-- Author Information -->
		<div class="mdl-tooltip" data-mdl-for="sign-proposal">
			{{_ "pages.proposals.view.tooltips.sign"}}
		</div>
		<div class="mdl-tooltip" data-mdl-for="copy-proposal-link">
			{{_ "pages.proposals.view.tooltips.share"}}
		</div>
		<div class="mdl-card mdl-cell mdl-cell--12-col proposal-details">
			<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
				<div class="minilogo">
					<img src="{{author.profile.photo}}" class="mdl-list__item-avatar">
				</div>
				<div class="proposal-author">
					{{#if author.profile.firstName}}
						<strong>{{author.profile.firstName}}&nbsp;{{author.profile.lastName}}</strong>
					{{else}}
						<strong>{{author.profile.username}}</strong>
					{{/if}}
					<span>{{createdAt}}</span>
				</div>

				<div class="section-spacer"></div>
				{{#if isEditable }}
					<button class="secondary-button mdl-button mdl-js-button mdl-js-ripple-effect" id="edit-proposal">
						{{_ "pages.proposals.view.editProposal"}}<i class="material-icons">create</i>
					</button>
				{{else}}
					<div>
						<button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" data-clipboard-text="{{getProposalLink}}" id="copy-proposal-link">
							<i class="material-icons">share</i>
						</button>
					</div>
					<div class="signature-button">
						<button id="sign-proposal" class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect {{#if isSigned}}mdl-button--colored{{/if}}">
							<i class="material-icons">{{#if isSigned}}favorite{{else}}favorite_border{{/if}}</i>
						</button>
					</div>
					<div class="signature-count">
						{{ signatureCount }}
					</div>
				{{/if}}
			</div>
			
			{{#if selectedInvites.count}}
			<div>
				<span id="collab-text">
					{{_ "pages.proposals.view.collaborators"}}
				</span>
			</div>
			<div class="mdl-color-text--grey-700 mdl-card__supporting-text" id="collab-chips">
				{{#each selectedInvites}}
				<div class="collab-author">
					<img class="mdl-chip__contact" src="{{profile.photo}}">
					{{#if profile.firstName}}
						<span class="mdl-chip__text">{{profile.firstName}}&nbsp;{{profile.lastName}}</span>
					{{else}}
						<span class="mdl-chip__text">{{profile.username}}</span>
					{{/if}}
				</div>
				{{/each}}
			</div>
			{{/if}}

		</div>

		<!-- Tabs for translations -->
		<div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
			<div class="mdl-tabs__tab-bar">
				{{#each languages}}
				<a href="#{{this}}-panel" class="mdl-tabs__tab {{activeClass this}}">{{this}}</a>
				{{/each}}
			</div>

			{{#each languages}}
			<div class="mdl-tabs__panel {{activeClass this}}" id="{{this}}-panel">
				{{> ProposalContent this}}
			</div>
			{{/each}}
		</div>

		<!-- Tags -->
		<div class="proposal-wrap">
			{{#each tags}}
			<span class="mdl-chip mdl-chip-hoverable">
				<a href="{{this.url}}" class="mdl-chip__text">{{this.keyword}}</a>
			</span>
			{{/each}}
		</div>

		<!-- Edit and Submit Buttons -->
		<div class="proposal-wrap proposal-actions">
			{{#if isSubmittable }}
			<button class="primary-button mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised" id="submit-proposal">
				{{_ "pages.proposals.view.submitProposal"}}
			</button>
			{{/if}}
		</div>

		<!-- Voting Buttons -->
		<div class="proposal-wrap proposal-vote">
			<hr>
			{{#if isVotable}}
			<div class="mdl-card mdl-cell mdl-cell--12-col vote-details">
				<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
					<div>
						<h5>{{_ "pages.proposals.view.voteHeading"}}</h5>
					</div>
					<div class="section-spacer"></div>

					<div class="signature-count">
						{{ startDate }}&nbsp;-&nbsp;{{ endDate }}&nbsp;
					</div>
					<div class="signature-count"><i class="material-icons">date_range</i></div>
				</div>
			</div>
			<div class="voting-content">
				{{#if isVotingAsDelegate}}
					{{> delegateVoteButtons proposalId=_id endDate=endDate}}
				{{else}}
					<p class="proposal-info">{{_"pages.proposals.view.voteInstructions"}}</p>
					{{> voteButtons proposalId=_id}}
					{{> delegateVoteList proposalId=_id}}
				{{/if}}
			</div>
			{{else}}
			<center>
				<h5>
					<small>{{_ "pages.proposals.view.inactive-vote-message" startDate=startDate endDate=endDate }}</small>
				</h5>
			</center>
			{{/if}}
			<hr>
		</div>

		<!-- Commenting -->
		{{#if showComments}}
			<div class="proposal-wrap">
				<div class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col">
					<div class="mdl-color-text--primary-contrast mdl-card__supporting-text comments">
						{{#if isInvited }}
						{{> CommentForm}}
						{{/if}}
						{{#if Template.subscriptionsReady}}
						{{#each comments}}
						{{> Comment}}
						{{/each}}

						{{else}}
						{{> loader}}
						{{/if}}
					</div>
				</div>
			</div>
		{{/if}}

		{{else}}
		<h3>{{_ "pages.proposals.view.proposalUnvailable"}}</h3>
		{{/if}}
	</div>

	<!-- Sign and Share buttons -->
	<div class="proposal-view-menu">
		<div class="proposal-view-menu-buttons">
			<button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" data-clipboard-text="{{getProposalLink}}" id="copy-proposal-link">
				<i class="material-icons">share</i>
			</button>
		</div>
	</div>
	{{else}}
	{{> loader}}
	{{/if}}
</template>

<!--=========== Proposal Content =========-->

<template name="ProposalContent">

	<!-- Main Content -->
	<div class="proposal-wrap">
		<h1 class="proposal-title">{{{ title }}}</h1><span class="status-chip">{{status}}</span>
		<p class="proposal-info">{{{ abstract }}}</p>
	</div>
	<div id="proposal-body-wrap">
		{{{ body }}}
	</div>

	<!-- Points for and against -->
	<div class="proposal-wrap mdl-grid" id="proposal-points">
		<div class="mdl-cell mdl-cell--6-col mdl-cell--6-col-tablet mdl-cell--12-col-phone">
			{{showPointsFor}}
			{{#if showPointsFor}}
			<p>{{_ "pages.proposals.view.pointsFor"}}</p>
			<ul id="points-for-list" class="points-list">
				{{#each pointsFor}}
				<li>{{this}}</li>
				{{/each}}
			</ul>
			{{/if}}
		</div>
		<div class="mdl-cell mdl-cell--6-col mdl-cell--6-col-tablet mdl-cell--12-col-phone">
			{{showPointsAgainst}}
			{{#if showPointsAgainst}}
			<p>{{_ "pages.proposals.view.pointsAgainst"}}</p>
			<ul id="points-against-list" class="points-list">
				{{#each pointsAgainst}}
				<li>{{this}}</li>
				{{/each}}
			</ul>
			{{/if}}
		</div>
	</div>
	
</template>


<!--============ Comment Form ============-->

<template name="CommentForm">
	<form class="comment-form" id="comment-form">
		<div class="input-wrap mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
			<textarea class="mdl-textfield__input" type="text" rows= "3" id="comment-message" ></textarea>
			<label class="mdl-textfield__label">{{_ "pages.proposals.view.addComment"}}</label>
		</div>
		<div class="form-group">
			<input class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised" type="submit" value='{{_ "pages.proposals.view.submit-comment"}}'>
		</div>
	</form>
</template>

<!--============ Single Comment ============-->

<template name="Comment">
	<div class="comment mdl-color-text--grey-700">
		<header class="comment__header">
			<img src="{{avatar}}" class="comment__avatar">
			<div class="comment__author">
				<strong>{{ username }}</strong>
				<span>{{ date }}</span>
			</div>
		</header>
		<div class="comment__text">
			{{ message }}
		</div>
	</div>
	<hr>
</template>
