<template name='ViewProposal'>
	{{> backButton text="Back to Proposals" url="/proposals"}}
	
	{{#if currentUser}}
	{{#if Template.subscriptionsReady}}
	<div class="app-container proposal-container">
		{{#if isVisible }}
			<h1 class="proposal-title">{{ title }}</h1>

			<div class="mdl-card__menu">
				<button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" data-clipboard-text="{{getProposalLink}}" id="copy-proposal-link">
					<i class="material-icons">share</i>
				</button>
				{{#if isLive}}
					<div class="mdl-layout-spacer"></div>
					<button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" id="sign-proposal">
						<i class="material-icons">{{ signatureIcon }}</i>
					</button>
					{{ signatureCount }}
				{{/if}}
			</div>

			<div class="proposal-wrap">
				<h5>{{_ "proposals.view.abstract"}}</h5>
				<p>{{ abstract }}</p>
			</div>

			<div class="proposal-wrap">
				<h5>{{_ "proposals.view.proposal"}}</h5>
				{{{ body }}}
			</div>

			<div class="proposal-wrap">
				{{#each tags}}
					<span class="mdl-chip">
						<a href="{{this.url}}" class="mdl-chip__text">{{this.keyword}}</a>
					</span>
				{{/each}}
			</div>

			<!-- Points for and against -->
			<div class="proposal-wrap">
				<div class="mdl-grid">
	  			<div class="mdl-cell mdl-cell--6-col mdl-cell--6-col-tablet mdl-cell--12-col-phone">
	  				{{#if showPointsFor}}
		  				<p>{{_ "proposals.view.pointsFor"}}</p>
							<ul id="points-for-list">
								{{#each pointsFor}}
									<li>{{this}}</li>
								{{/each}}
							</ul>
						{{/if}}
	  			</div>
	  			<div class="mdl-cell mdl-cell--6-col mdl-cell--6-col-tablet mdl-cell--12-col-phone">
						{{#if showPointsAgainst}}
		  				<p>{{_ "proposals.view.pointsAgainst"}}</p>
							<ul id="points-against-list">
								{{#each pointsAgainst}}
									<li>{{this}}</li>
								{{/each}}
							</ul>
						{{/if}}
	  			</div>
	  			
	  		</div>
  		</div>
			<!-- References & Links -->

			<small>{{_ "proposals.view.voteStarts"}}&nbsp;{{ startDate }}</small>
			<br />
			<small>{{_ "proposals.view.voteEnds"}}&nbsp;{{ endDate }}</small>

			<div class="proposal-actions">
				{{#if isEditable }}
					<button class="secondary-button mdl-button mdl-js-button mdl-js-ripple-effect" id="edit-proposal">
						{{_ "proposals.view.editProposal"}}
					</button>
				{{/if}}

				{{#if isSubmittable }}
					<button class="primary-button mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised" id="submit-proposal">
						{{_ "proposals.view.submitProposal"}}
					</button>
				{{else}}
					<span class="mdl-chip">
						<span class="mdl-chip__text">
							{{ status }}
						</span>
					</span>
				{{/if}}
			</div>

			{{#if isVotable}}
				<hr>
				<h5>{{_ "proposals.view.voteHeading"}}</h5>
				{{#if isVotingAsDelegate}}
					{{#if isVotableForDelegates}}
						{{> delegateVoteButtons}}
					{{else}}
						<small>{{_"proposals.view.delegateVotingClosed"}}</small>
					{{/if}}
				{{else}}
					<div class="vote-actions">
						<button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised {{userYesClass}} {{delegateYesClass}}" id="vote-yes">
							Yes
						</button>
						<button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised {{userNoClass}} {{delegateNoClass}}" id="vote-no">
							No
						</button>
					</div>
				{{/if}}
				<hr>

				<div class="mdl-grid delegateVoteGrid">
				  <div class="mdl-cell mdl-cell--6-col">
				  	<h5>{{_ "proposals.view.delegatesFor"}}</h5>
				  	{{#if delegatesFor}}
					  	<ul class="delegateVoteList demo-list-control mdl-list" >
					  		{{#each delegatesFor}}
					  			{{> delegateVoteListItem}}
					  		{{/each}}
					  	</ul>
				  	{{else}}
				  	<small>{{_ "proposals.view.noDelegatesVoted"}}</small>
				  	{{/if}}
					</div>
				  <div class="mdl-cell mdl-cell--6-col">
				  	<h5>{{_ "proposals.view.delegatesAgainst"}}</h5>
				  	{{#if delegatesAgainst}}
					  	<ul class="demo-list-control mdl-list" >
							{{#each delegatesAgainst}}
								{{> delegateVoteListItem}}
							{{/each}}
						</ul>
					{{else}}
						<small>{{_ "proposals.view.noDelegatesVoted"}}</small>
				  	{{/if}}
				  </div>
				</div>
			{{/if}}

			<hr>

			{{#if isInvited }}
				{{> CommentForm}}
			{{/if}}

			{{#if Template.subscriptionsReady}}
				<ul class="demo-list-control mdl-list">
					{{#each comments}}
						{{> Comment}}
					{{/each}}
				</ul>
			{{else}}
				{{> loader}}
			{{/if}}
		{{else}}
			<h3>{{_ "proposals.view.proposalUnvailable"}}</h3>
		{{/if}}
	</div>
	{{else}}
		{{> loader}}
	{{/if}}
	{{/if}}
</template>

<!--============ Single delegate item ============-->

<template name="delegateVoteListItem">
	<li class="selected mdl-list__item delegate-vote-list-item" id="{{_id}}">
		<div class="card-main-wrap">
			<span class="card-main mdl-list__item-primary-content">
				<i class="material-icons">{{voteIcon vote_info.[0].vote}}</i> &nbsp;
				<img src={{user_info.[0].profile.photo}} class="mdl-list__item-avatar">
				#{{ranking}}&nbsp; {{user_info.[0].profile.firstName}}&nbsp;{{user_info.[0].profile.lastName}} ({{user_info.[0].profile.username}})
			</span>
		</div>
	</li>
	<div class="mdl-tooltip" for="{{_id}}">
	{{#if vote_info.[0].reason}}
		{{vote_info.[0].reason}}
	{{else}}
		{{_ "proposals.view.noDelegateReason"}}
	{{/if}}
	</div>
</template>

<!--============ Comment Form ============-->

<template name="CommentForm">
	<form class="comment-form" id="comment-form">
		<div class="input-wrap mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
			<textarea class="mdl-textfield__input" type="text" rows= "3" id="comment-message" ></textarea>
			<label class="mdl-textfield__label">{{_ "proposals.view.addComment"}}</label>
		</div>
		<div class="form-group">
			<input class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised" type="submit" value='{{_ "submit"}}'>
		</div>
	</form>
</template>

<!--============ Single Comment ============-->

<template name="Comment">
	<li class="delegate-item mdl-list__item">
		<div class="card-main-wrap">
			<span class="card-main mdl-list__item-primary-content">
				<img src="{{avatar}}" class="mdl-list__item-avatar">
				<h6>{{ username }}</h6>
			</span>
			<span class="right mdl-list__item-secondary-action">
				<small class="proposal-date">{{ date }}</small>
			</span>
		</div>
		<div class="card-secondary-wrap">
			<p class="proposal-abstract">
				{{ message }}
			</p>
		</div>
	</li>
</template>
