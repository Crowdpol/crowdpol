<template name="AdminProposals">
	{{> ProposalModal}}
	{{#if currentUserIsAdmin}}
	<div class="dashboard__item dashboard__item--full">
		<div class="card">
			{{#if Template.subscriptionsReady}}
				<div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
					<div class="mdl-tabs__tab-bar">
							<a href="#submitted-proposals" class="mdl-tabs__tab is-active">Submitted</a>
							<a href="#live-proposals" class="mdl-tabs__tab">Live</a>
							<a href="#all-proposals" class="mdl-tabs__tab">All</a>
					</div>
					<div class="mdl-tabs__panel is-active" id="submitted-proposals">
							{{#if submittedProposals.count}}
								<table class="mdl-data-table mdl-js-data-table mdl-data-table">
										<thead>
												<tr>
														<th>{{_"admin.proposals.date"}}</th>
														<th>{{_"admin.proposals.author"}}</th>
														<th>{{_"admin.proposals.contributors"}}</th>
														<th>{{_"admin.proposals.title"}}</th>
														<th></th>
												</tr>
										</thead>
										<tbody>
											{{#each proposal in submittedProposals}}
												{{> AdminProposal proposal=proposal type="submitted"}}
											{{/each}}
										</tbody>
								</table>
							{{else}}
								<br>
								<center>
									<p>
										{{_"admin.tags.none-waiting"}}
									</p>
								</center>
							{{/if}}
					</div>
					<div class="mdl-tabs__panel" id="live-proposals">
							{{#if liveProposals.count}}
								<table class="mdl-data-table mdl-js-data-table mdl-data-table">
										<thead>
												<tr>
														<th>{{_"admin.proposals.date"}}</th>
														<th>{{_"admin.proposals.author"}}</th>
														<th>{{_"admin.proposals.contributors"}}</th>
														<th>{{_"admin.proposals.title"}}</th>
														<th></th>
														<th></th>
												</tr>
										</thead>
										<tbody>
											{{#each proposal in  liveProposals}}
												{{> AdminProposal proposal=proposal type="live"}}
											{{/each}}
										</tbody>
								</table>
							{{else}}
								<br>
								<center>
									<p>
										"There are currently no live proposals"
									</p>
								</center>
							{{/if}}
					</div>
					<div class="mdl-tabs__panel" id="all-proposals">
							{{#if allProposals.count}}
								<table class="mdl-data-table mdl-js-data-table mdl-data-table">
										<thead>
												<tr>
														<th>{{_"admin.proposals.date"}}</th>
														<th>{{_"admin.proposals.author"}}</th>
														<th>{{_"admin.proposals.contributors"}}</th>
														<th>{{_"admin.proposals.title"}}</th>
														<th></th>
												</tr>
										</thead>
										<tbody>
											{{#each proposal in  allProposals}}
												{{> AdminProposal proposal=proposal  type="all"}}
											{{/each}}
										</tbody>
								</table>
							{{else}}
								<br>
								<center>
									<p>
										There are currently no proposals in the system.
									</p>
								</center>
							{{/if}}
					</div>
				</div>
			{{else}}
				<p>
					{{_ "generic.loading"}}
				</p>
			{{/if}}
		</div>
	</div>

	{{/if}}
</template>

<template name="AdminProposal">
	<tr>
	  <td class="mdl-data-table__cell--non-numeric" data-label='{{_"admin.proposals.date"}}'>{{lastModified}}</td>
	  <td class="mdl-data-table__cell--non-numeric" data-label='{{_"admin.proposals.author"}}'>{{author proposal.authorId}}</td>
	  <td class="mdl-data-table__cell--non-numeric" data-label='{{_"admin.proposals.contributors"}}'>
	    {{contributerCount proposal}}
	  </td>
	  <td class="mdl-data-table__cell--non-numeric" data-label='{{_"admin.proposals.title"}}'> <a href="/proposals/view/{{_id}}">{{title proposal}}</a></td>
	  <td class="mdl-data-table__cell--non-numeric" data-label="">
	    <button class="mdl-button mdl-js-button mdl-button--icon preview-proposal" data-id="{{proposal._id}}" data-type="{{type}}">
	      <i class="material-icons preview-proposal" data-id="{{proposal._id}}" data-type="{{type}}">visibility</i>
	    </button>
		</td>
		<td class="mdl-data-table__cell--non-numeric">
			<button class="mdl-button mdl-js-button mdl-button--icon delete-proposal" data-id="{{proposal._id}}" data-type="{{type}}">
	      <i class="material-icons delete-proposal" data-id="{{proposal._id}}" data-type="{{type}}">delete</i>
	    </button>
	  </td>
	</tr>
</template>


<template name="ProposalModal">
  <div id="overlay"></div>
	<div class="proposal-modal">
	  <form class='content-wrapper'>
	    {{#if proposal}}

	    <div class="content">
	      <div class="app-container proposal-container">
					<!-- Author Information -->
					<div class="mdl-card mdl-cell mdl-cell--12-col proposal-details">
						<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
							<div class="minilogo">
								<img src="{{author.profile.photo}}" class="mdl-list__item-avatar">
							</div>
							<div class="proposal-author">
								{{#if author.profile.firstName}}
									<strong>{{author.profile.firstName}}&nbsp;{{author.profile.lastName}}</strong>
								{{else}}
									<strong>{{author.profile.username}}</strong>
								{{/if}}
								<span>{{propDate proposal.lastModified}}</span>
							</div>
						</div>
						{{#if selectedInvites.count}}
							<div>
								<span id="collab-text">
									{{_ "pages.proposals.view.collaborators"}}
								</span>
							</div>
							<div class="mdl-color-text--grey-700 mdl-card__supporting-text" id="collab-chips">
								{{#each selectedInvites}}
								<div class="collab-author">
									<img class="mdl-chip__contact" src="{{profile.photo}}">
									{{#if profile.firstName}}
										<span class="mdl-chip__text">{{profile.firstName}}&nbsp;{{profile.lastName}}</span>
									{{else}}
										<span class="mdl-chip__text">{{profile.username}}</span>
									{{/if}}
								</div>
								{{/each}}
							</div>
						{{/if}}
					</div>
					{{#each content}}
						<!-- Tabs for translations -->
						<div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
							<div class="mdl-tabs__tab-bar">
								<a href="#{{this}}-panel" class="mdl-tabs__tab {{activeClass this}}">{{language}}</a>
							</div>
						</div>

						<div class="mdl-tabs__panel {{activeClass this}}" id="{{this}}-panel">
							<!-- Main Content -->
							<div class="proposal-wrap">
								<h1 class="proposal-title">{{{ title }}}</h1><span class="status-chip">{{proposal.status}}</span>
								<p class="proposal-info">{{{ abstract }}}</p>
							</div>
							<div id="proposal-body-wrap">
								{{{ body }}}
							</div>

							<!-- Points for and against -->
							<div class="proposal-wrap mdl-grid" id="proposal-points">
								<div class="mdl-cell mdl-cell--6-col mdl-cell--6-col-tablet mdl-cell--12-col-phone">
									<p>{{_ "pages.proposals.view.pointsFor"}}</p>
									<ul id="points-for-list" class="points-list">
										{{#each pointsFor}}
										<li>{{this}}</li>
										{{/each}}
									</ul>
								</div>
								<div class="mdl-cell mdl-cell--6-col mdl-cell--6-col-tablet mdl-cell--12-col-phone">
									<p>{{_ "pages.proposals.view.pointsAgainst"}}</p>
									<ul id="points-against-list" class="points-list">
										{{#each pointsAgainst}}
										<li>{{this}}</li>
										{{/each}}
									</ul>
								</div>
							</div>
						</div>
					{{/each}}
					<!-- Tags -->
					<div class="proposal-wrap">
						{{#each proposal.tags}}
						<span class="mdl-chip mdl-chip-hoverable">
							<a href="{{this.url}}" class="mdl-chip__text">{{this.keyword}}</a>
						</span>
						{{/each}}
					</div>

	      </div>
	    </div>
	    {{/if}}
			{{#if showApproval}}
	    <div class="btn-wrapper">
	      <button class="mdl-button mdl-js-button mdl-button--raised" data-proposal-id="{{_id}}" data-type="{{type}}" id="approve-button">
					<i class="material-icons" data-proposal-id="{{_id}}">check</i>
					{{_'admin.proposals.approve-button'}}
				</button>
				<button class="mdl-button mdl-js-button mdl-button--raised" data-proposal-id="{{_id}}" data-type="{{type}}" id="reject-button">
					<i class="material-icons" data-proposal-id="{{_id}}">close</i>
					{{_'admin.proposals.reject-button'}}
				</button>
	    </div>
			{{/if}}
	  </form>
	</div>
</template>
